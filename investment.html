<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Планировщик регулярных доходов</title>
    <link href="/css/bootstrap.css" rel="stylesheet">
    <link href="/css/theme.css" rel="stylesheet">
    <link href="/css/investment.css" rel="stylesheet">
    <script src="/js/color-modes.js"></script>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="js/investment.js"></script>
</head>
<body>
<main class="container-fluid my-4">
    <!-- Summary -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col" aria-label="Доход / прогноз">
                    <strong>Текущий доход:</strong> <span id="pIncomeCur">110</span>
                    <br><strong>Прогноз через 3 мес:</strong> <span id="pIncome3m">95</span>
                </div>
                <div class="col" aria-label="Проблемные источники">
                    <strong>Проблемные источники:</strong>
                    <span id="pTroubles">
                        <br>Аренда квартиры
                        <br>Инвестиции в акции
                    </span>
                </div>
                <!-- Кнопки управления в правом углу карточки -->
                <div class="d-grid gap-2 col-auto">
                    <button class="btn btn-primary btn-sm" evnt-click-add>
                        + Добавить
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" id="btnRestore" title="Отменить удаление" evnt-click-restore disabled>
                        Отменить
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="timeline-table table table-bordered">
            <thead id="tlHeader">
            <tr class="timeline-month test-static d-none">
                <th scope="col">Источник</th>
                <th scope="col">Сумма</th>
                <th scope="col">Дек</th>
                <th scope="col">Янв</th>
                <th scope="col">Фев</th>
                <th scope="col">Мар</th>
                <th scope="col">Апр</th>
                <th scope="col">Май</th>
                <th scope="col">Июн</th>
            </tr>
            <tr class="timeline-year test-static d-none">
                <td colspan="2"></td>
                <td>2025</td>
                <td colspan="6">2026</td>
            </tr>
            <tr class="monthly-sum test-static d-none">
                <th colspan="2">Сумма по месяцам</th>
                <td>140к</td>
                <td>110к</td>
                <td>105к</td>
                <td>104к</td>
                <td>105к</td>
                <td>105к</td>
                <td>100к</td>
            </tr>
            </thead>
            <tbody id="tlBody">
            <!-- Источник 1: Зарплата (не требует особого внимания, зелёный) -->
            <tr class="timeline-row test-static d-none">
                <td>Зарплата<br><span class="source-desc">С 01.01.2025 (бесконечно)</span></td>
                <td>90к</td>
                <td><div class="income-bar">90к</div></td>
                <td><div class="income-bar">90к</div></td>
                <td><div class="income-bar">90к</div></td>
                <td><div class="income-bar">90к</div></td>
                <td><div class="income-bar">90к</div></td>
                <td><div class="income-bar">90к</div></td>
                <td><div class="income-bar">90к</div></td>
            </tr>
            <!-- Источник 2: Аренда (проблемная, красный) -->
            <tr class="timeline-row test-static d-none">
                <td>
                    <div class="d-flex justify-content-between align-items-center">
                        <div>Аренда квартиры<br><span class="source-desc">С 01.06.2025 по 31.12.2025</span></div>
                        <button class="btn flex-shrink-0 px-1">✎</button>
                    </div>
                </td>
                <td>30к</td>
                <td><div class="income-bar red">30к</div></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <!-- Источник 3: Депозит (еще не начался, серый) -->
            <tr class="timeline-row test-static d-none">
                <td>
                    <div class="d-flex justify-content-between align-items-center">
                        <div>Депозит в банке<br><span class="source-desc">С 20.02.2026 по 20.06.2026</span></div>
                        <button class="btn flex-shrink-0 px-1" title="Редактировать / удалить">✎</button>
                    </div>
                </td>
                <td>60к</td>
                <td></td>
                <td></td>
                <td><div class="income-bar gray" style="left: 61%; width: 39%;">5к</div></td>
                <td><div class="income-bar gray">14к</div></td>
                <td><div class="income-bar gray">15к</div></td>
                <td><div class="income-bar gray">15к</div></td>
                <td><div class="income-bar gray" style="width: 66%;">10к</div></td>
            </tr>
            <!-- Источник 4: Инвестиции в акции (скоро заканчиваются, желтый) -->
            <tr class="timeline-row test-static d-none">
                <td>Инвестиции в акции<br><span class="source-desc">С 01.11.2025 по 18.02.2026</span></td>
                <td>70к</td>
                <td><div class="income-bar yellow">20к</div></td>
                <td><div class="income-bar yellow">20к</div></td>
                <td><div class="income-bar yellow" style="width: 68%">10к</div></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            </tbody>
        </table>
    </div>
</main>

<!-- Модальное окно редактирования источника дохода -->
<div class="modal fade" id="sourceModal" tabindex="-1" aria-labelledby="sourceModalTitle">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="sourceModalTitle">Источник дохода</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="sourceForm" novalidate>

                    <div class="mb-3">
                        <label for="fName" class="form-label">Название</label>
                        <input type="text" class="form-control" id="fName" required>
                        <div class="invalid-feedback">Введите название источника</div>
                    </div>

                    <div class="mb-3">
                        <label for="fType" class="form-label">Тип</label>
                        <select class="form-select" id="fType" required evnt-change-type>
                            <option value="monthly">Ежемесячный (зарплата, аренда…)</option>
                            <option value="investment">Инвестиция (депозит, акции…)</option>
                        </select>
                    </div>

                    <div class="row mb-3">
                        <div class="col">
                            <label for="fSum" class="form-label" id="fSumLabel">Сумма, руб.</label>
                            <input type="number" class="form-control" id="fSum" min="1" required>
                            <div class="invalid-feedback">Введите положительное число</div>
                        </div>
                        <!-- Поле дохода показывается только для инвестиций -->
                        <div class="col" id="fIncomeGroup">
                            <label for="fIncome" class="form-label">Ожидаемый доход, руб.</label>
                            <input type="number" class="form-control" id="fIncome" min="1">
                            <div class="invalid-feedback">Введите ожидаемый доход</div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col">
                            <label for="fStart" class="form-label">Дата начала</label>
                            <input type="date" class="form-control" id="fStart" required evnt-change-dates>
                            <div class="invalid-feedback">Укажите дату начала</div>
                        </div>
                        <div class="col">
                            <label for="fEnd" class="form-label" id="fEndLabel">Дата окончания</label>
                            <input type="date" class="form-control" id="fEnd" evnt-change-dates>
                            <div class="invalid-feedback" id="fEndFeedback">Укажите дату окончания</div>
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <!-- Кнопка удаления скрыта при добавлении нового источника -->
                <button type="button" class="btn btn-outline-danger me-auto" id="btnDelete" evnt-click-delete>Удалить</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary" id="btnSave" evnt-click-save>Сохранить</button>
            </div>
        </div>
    </div>
</div>

</body>
</html>